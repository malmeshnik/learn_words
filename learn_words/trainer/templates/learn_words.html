<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–í–∏–≤—á–µ–Ω–Ω—è —Å–ª—ñ–≤</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            padding: 40px;
            background-color: #f4f7f6;
            color: #333;
        }
        
        h2 {
            font-size: 36px;
            color: #1e88e5;
        }

        .control-inputs {
            margin: 30px 0;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
        }

        .control-inputs input, select {
            margin: 10px 0;
            padding: 10px;
            font-size: 16px;
            width: 220px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .control-inputs input:focus, select:focus {
            outline: none;
            border-color: #1e88e5;
        }

        #startBtn {
            font-size: 20px;
            padding: 12px 24px;
            background-color: #1e88e5;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #startBtn:hover {
            background-color: #1565c0;
        }

        .word-box {
            font-size: 36px;
            margin: 40px 0;
            font-weight: bold;
            color: #1e88e5;
        }

        .translation {
            font-size: 28px;
            color: #388e3c;
            margin-bottom: 20px;
        }

        .result-buttons button {
            font-size: 18px;
            padding: 10px 20px;
            margin: 10px;
            background-color: #4caf50;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .result-buttons button:hover {
            background-color: #388e3c;
        }

        .words-container {
            display: flex;
            flex-direction: column-reverse;
            margin-top: 30px;
        }

        .word-item {
            padding: 12px;
            background-color: #fff;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
            font-size: 18px;
        }

        .word-item:hover {
            background-color: #e3f2fd;
        }

        .word-checkbox {
            width: 18px;
            height: 18px;
            accent-color: #1e88e5;
            margin-right: 10px;
        }

        .word-text {
            color: #333;
            font-weight: bold;
        }

        .completed-message {
            font-size: 24px;
            color: #555;
            margin-top: 40px;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å –¥–ª—è –º–µ–Ω—à–∏—Ö –µ–∫—Ä–∞–Ω—ñ–≤ */
        @media (max-width: 768px) {
            h2 {
                font-size: 28px;
            }

            .control-inputs input, select {
                width: 180px;
            }

            .word-box {
                font-size: 28px;
            }

            .translation {
                font-size: 24px;
            }

            .result-buttons button {
                font-size: 16px;
                padding: 8px 16px;
            }

            .word-item {
                font-size: 16px;
            }

            #startBtn {
                width: 100%;
                padding: 12px 0;
            }

            .words-container {
                margin-top: 20px;
            }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ */
        @media (max-width: 480px) {
            body {
                padding: 20px;
            }

            h2 {
                font-size: 24px;
            }

            .control-inputs input, select {
                width: 100%;
            }

            .word-box {
                font-size: 24px;
            }

            .translation {
                font-size: 20px;
            }

            .result-buttons button {
                font-size: 14px;
                padding: 8px 16px;
            }

            .word-item {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <h2>–í–∏–≤—á–µ–Ω–Ω—è –∞–Ω–≥–ª—ñ–π—Å—å–∫–∏—Ö —Å–ª—ñ–≤</h2>

    <div class="control-inputs" id="settingsBlock">
        <div>
            <label for="repeatCount">üîÅ –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω—å –∫–æ–∂–Ω–æ–≥–æ —Å–ª–æ–≤–∞:</label><br>
            <input type="number" id="repeatCount" value="1" min="1">
        </div>
        <div>
            <label for="pauseBetween">‚è∏Ô∏è –ü–∞—É–∑–∞ –º—ñ–∂ —Å–ª–æ–≤–∞–º–∏ (—Å):</label><br>
            <input type="number" id="pauseBetween" value="1" min="0">
        </div>
        <div>
            <label for="delayBeforeTranslation">‚è≥ –ó–∞—Ç—Ä–∏–º–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫–ª–∞–¥–æ–º (—Å):</label><br>
            <input type="number" id="delayBeforeTranslation" value="0.5" min="0">
        </div>
    </div>

    <button id="startBtn" onclick="startLearning()">–ü–æ—á–∞—Ç–∏</button>

    <div id="wordsList">
        <!-- –î–æ–¥–∞–º–æ —Å–ø–∏—Å–æ–∫ —Å–ª—ñ–≤ —Ç—É—Ç -->
    </div>

    <div class="word-box" id="wordBox"></div>

    <div class="result-buttons" id="mainMenuButton" style="display: none;">
        <button onclick="goToMainMenu()">–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é</div>
    </div> 
    <div class="result-buttons" id="restartButton" style="display: none;">
        <button onclick="restartLearning()">–ü–æ–≤—Ç–æ—Ä–∏—Ç–∏ –∑–Ω–æ–≤—É</div>
    </div> 

    <div class="translation" id="translationBox"></div>

    <h3>–ü–æ–∑–Ω–∞—á—Ç–µ —Å–ª–æ–≤–æ —è–∫–µ –≤–∂–µ –≤–∏–≤—á–∏–ª–∏</h3>
    <div class="words-container" id="wordsContainer"></div>

    <audio id="audioPlayer"></audio>

    <script>
        const words = {{ words|safe }};
        const sentences = {{ sentence|safe }};
        let index = 0;
        const audioPlayer = document.getElementById('audioPlayer');
    
        function triggerAudioPlay() {
            const audio = new Audio(); // –ü—Ä–æ—Å—Ç–æ —Å—Ç–≤–æ—Ä—é—î–º–æ –∞—É–¥—ñ–æ –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
            audio.play();
        }
        
        // –ó–∞—Ç—Ä–∏–º–∫–∞ –ø–µ—Ä–µ–¥ –Ω–∞—Å—Ç—É–ø–Ω–∏–º —Å–ª–æ–≤–æ–º
        async function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞—É–¥—ñ–æ
        async function playAudio(src) {
            return new Promise((resolve) => {
                audioPlayer.src = src;
                audioPlayer.play().then(() => {
                    audioPlayer.onended = resolve;
                }).catch((err) => {
                    console.warn("Audio play error:", err);
                    resolve(); // –©–æ–± –Ω–µ –∑–∞–≤–∏—Å–∞–ª–æ
                });
            });
        }
    
        async function showWord() {
            if (index >= words.length) {
                await showSentences();
                document.getElementById('wordBox').textContent = "–í–∏ –≤–∏–≤—á–∏–ª–∏ –≤—Å—ñ —Å–ª–æ–≤–∞!";
                document.getElementById('translationBox').textContent = "";
                document.getElementById('resultButtons').style.display = 'block';
                return;
            }
    
            const word = words[index];
            const repetitions = parseInt(document.getElementById('repeatCount').value);
            const pauseBetween = parseInt(document.getElementById('pauseBetween').value) * 1000;
            const delayBeforeTranslation = parseInt(document.getElementById('delayBeforeTranslation').value) * 1000;
    
            for (let i = 0; i < repetitions; i++) {
                document.getElementById('wordBox').textContent = word.en;
                document.getElementById('translationBox').textContent = "";
    
                await playAudio(`/media/audio/en/${word.id}.mp3`);
                await sleep(delayBeforeTranslation);
    
                document.getElementById('translationBox').textContent = word.ru;
                await playAudio(`/media/audio/ru/${word.id}.mp3`);
                await sleep(pauseBetween);
            }
    
            const wordElement = document.createElement('div');
            const wordText = document.createElement('span');
            const checkbox = document.createElement('input');

            wordElement.classList.add('word-item');
            wordText.classList.add('word-text')
            checkbox.classList.add('word-checkbox')

            wordText.textContent = `${word.en} - ${word.ru}`;
            checkbox.type = 'checkbox';
            checkbox.addEventListener('change', () => {
                wordElement.style.textDecoration = checkbox.checked ? 'line-through' : 'none';
            });
    
            wordElement.appendChild(checkbox);
            wordElement.appendChild(wordText);
            document.getElementById('wordsContainer').appendChild(wordElement);
    
            index++;
        }
    
        async function showSentences() {
            let index = 0;
            const repetitions = parseInt(document.getElementById('repeatCount').value); // –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω—å
            const pauseBetween = parseInt(document.getElementById('pauseBetween').value); // –ü–∞—É–∑–∞ –º—ñ–∂ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è–º–∏
            const delayBeforeTranslation = parseInt(document.getElementById('delayBeforeTranslation').value); // –ó–∞—Ç—Ä–∏–º–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫–ª–∞–¥–æ–º
        
            // –ü–µ—Ä–µ–±–∏—Ä–∞—î–º–æ –≤—Å—ñ —Ä–µ—á–µ–Ω–Ω—è –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ–≤–∞
            for (const word of words) {
                for (const sentence of sentences) {
                    if (sentence.template.includes(word.en)) {
                        for (let i = 0; i < repetitions; i++) {
                            // –í–∏–≤–æ–¥–∏–º–æ —Ä–µ—á–µ–Ω–Ω—è –Ω–∞ –∞–Ω–≥–ª—ñ–π—Å—å–∫—ñ–π –º–æ–≤—ñ
                            document.getElementById('wordBox').textContent = sentence.template;
                            document.getElementById('translationBox').textContent = "";
        
                            // –û–∑–≤—É—á—É—î–º–æ —Ä–µ—á–µ–Ω–Ω—è –Ω–∞ –∞–Ω–≥–ª—ñ–π—Å—å–∫—ñ–π –º–æ–≤—ñ
                            await playAudio(`/media/audio/sentence/en/sentence_${sentence.id}_${word.id}_en.mp3`);
                            await sleep(delayBeforeTranslation);
        
                            // –í–∏–≤–æ–¥–∏–º–æ –ø–µ—Ä–µ–∫–ª–∞–¥ –Ω–∞ —Ä–æ—Å—ñ–π—Å—å–∫—ñ–π –º–æ–≤—ñ
                            document.getElementById('translationBox').textContent = sentence.translate;
        
                            // –û–∑–≤—É—á—É—î–º–æ –ø–µ—Ä–µ–∫–ª–∞–¥ –Ω–∞ —Ä–æ—Å—ñ–π—Å—å–∫—ñ–π –º–æ–≤—ñ
                            await playAudio(`/media/audio/sentence/ru/sentence_${sentence.id}_${word.id}_ru.mp3`);
                            await sleep(pauseBetween);
                        }
                    }
                }
                index++;
            }
            // –ö–æ–ª–∏ –≤—Å—ñ —Ä–µ—á–µ–Ω–Ω—è –æ–±—Ä–æ–±–ª–µ–Ω—ñ, –≤–∏–≤–æ–¥–∏–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
            document.getElementById('wordBox').textContent = "–ì–æ—Ç–æ–≤–æ! üéâ";
            document.getElementById('translationBox').textContent = "";
        }        
        
    
        async function startLearning() {
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('settingsBlock').style.display = 'none';
            while (index < words.length) {
                await showWord();
            }
            await showSentences();
            document.getElementById('wordBox').textContent = "–ì–æ—Ç–æ–≤–æ! üéâ";
            document.getElementById('translationBox').textContent = "";
            document.getElementById('restartButton').style.display = 'block';
            document.getElementById('mainMenuButton').style.display = 'block';
        }
    
        function restartLearning() {
            index = 0;
            document.getElementById('restartButton').style.display = 'none';
            document.getElementById('mainMenuButton').style.display = 'none';
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('settingsBlock').style.display = 'block';
            document.getElementById('wordBox').textContent = '';
            document.getElementById('translationBox').textContent = '';
            document.getElementById('wordsContainer').innerHTML = '';
        }
    
        function goToMainMenu() {
            window.location.href = '/';
        }
    </script>
</body>
</html>
